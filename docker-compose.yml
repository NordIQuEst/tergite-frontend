---
version: "3"

services:
  landing-page:
    restart: always
    depends_on:
      - mss
***REMOVED***
    logging:
      driver: ${LOGGING_DRIVER}
    ports:
      - "8030:80"
    environment:
      - API_BASE_URL=http://mss
      - AUTH_CONFIG_FILE=/app/auth_config.toml
    volumes:
      - ./auth_config.toml:/app/auth_config.toml:ro
    env_file:
      - .env
    networks:
      - tergite-frontend

  mss:
    restart: always
***REMOVED***
    logging:
      driver: ${LOGGING_DRIVER}
    ports:
      - "8002:80"
    environment:
      - AUTH_CONFIG_FILE=/code/auth_config.toml
    volumes:
      - ./auth_config.toml:/code/auth_config.toml:ro
    env_file:
      - .env
    networks:
      - tergite-frontend

  webgui:
    restart: always
    depends_on:
      - mss
    # yes, we can build from the Dockerfiles but we might need to run frontend from pre-built images
***REMOVED***
    logging:
      driver: ${LOGGING_DRIVER}
    ports:
      - "3000:3000"
    environment:
      - API_BASE_URL=http://mss
      - AUTH_CONFIG_FILE=/app/auth_config.toml
    volumes:
      - ./auth_config.toml:/app/auth_config.toml:ro
    env_file:
      - .env
    networks:
      - tergite-frontend

  loki-promtail:
    restart: always
    image: grafana/promtail:${PROMTAIL_VERSION:-2.8.3}
    logging:
      driver: ${LOGGING_DRIVER}
    volumes:
      - ./promtail.yaml:/etc/promtail/config.yaml:ro
      - /var/run/docker.sock:/var/run/docker.sock
      - ./.data/promtail:/tmp
    command: "-config.expand-env=true -config.file=/etc/promtail/config.yaml"
    env_file:
      - .env
    networks:
      - tergite-frontend

networks:
  tergite-frontend:
